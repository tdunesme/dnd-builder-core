// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider     = "prisma-client"
  output       = "../src/generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "sqlite"
}

// User
model User {
  id           String   @id @default(cuid())
  email        String   @unique
  passwordHash String
  firstName    String
  lastName     String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  characters Character[]
}

model Character {
  id String @id @default(cuid())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Ownership
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Identity
  name  String
  level Int    @default(1)

  // SRD references (indexes only)
  raceIndex    String?
  subraceIndex String?

  classIndex    String?
  subclassIndex String?

  backgroundIndex String?
  alignmentIndex  String?

  // Ability Scores (raw values only)
  strength     Int?
  dexterity    Int?
  constitution Int?
  intelligence Int?
  wisdom       Int?
  charisma     Int?

  // Relations (pure choices)
  skills        CharacterSkill[]
  proficiencies CharacterProficiency[]
  languages     CharacterLanguage[]
  spells        CharacterSpell[]
  equipment     CharacterEquipment[]

  @@index([userId])
}

model CharacterSkill {
  id String @id @default(cuid())

  characterId String
  character   Character @relation(fields: [characterId], references: [id], onDelete: Cascade)

  skillIndex String

  @@unique([characterId, skillIndex])
}

model CharacterProficiency {
  id String @id @default(cuid())

  characterId String
  character   Character @relation(fields: [characterId], references: [id], onDelete: Cascade)

  proficiencyIndex String

  @@unique([characterId, proficiencyIndex])
}

model CharacterLanguage {
  id String @id @default(cuid())

  characterId String
  character   Character @relation(fields: [characterId], references: [id], onDelete: Cascade)

  languageIndex String

  @@unique([characterId, languageIndex])
}

model CharacterSpell {
  id String @id @default(cuid())

  characterId String
  character   Character @relation(fields: [characterId], references: [id], onDelete: Cascade)

  spellIndex String

  // Optionnel â€“ utile plus tard
  source String? // class | race | feat | item

  @@unique([characterId, spellIndex])
}

model CharacterEquipment {
  id String @id @default(cuid())

  characterId String
  character   Character @relation(fields: [characterId], references: [id], onDelete: Cascade)

  equipmentIndex String
  quantity       Int    @default(1)

  @@unique([characterId, equipmentIndex])
}
